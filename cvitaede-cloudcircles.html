<dom-module id="cvitaede-cloudcircles">
  <template>
    <style>
     :host {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }
    
     :host div {
      display: flex;
      justify-content: center;
      text-align:center;
      align-items: center;
      background: #CC0;
      color: #FFF;
      border-radius: 50%;
      text-shadow: 2px 2px 4px black;
      text-transform: capitalize;
    }

    </style>
    <template is="dom-repeat" items="{{elements}}">
      <div style="width:{{item.value}}px; height:{{item.value}}px; background:{{item.bg}}; font-size:{{item.fontsize}}">{{item.name}}</div>
    </template>
  </template>

  <script>
  Polymer({

    is: 'cvitaede-cloudcircles',

    properties: {
      elements: {
        type: Object
      }
    },

    attached: function() {
      var els = this.queryAllEffectiveChildren("cvitaede-cloudcircle");
      if (els) {
        var elements = []; els.forEach(function(item){elements.push({"name":item.attributes.name.value, "value":item.attributes.value.value, "bg": item.attributes.bg.value})});
        var arr = Object.keys(elements).map(function (k) { return elements[k].value; });
        var min = Math.min.apply( null, arr ); 
        var arr = elements.forEach(function (item) { item.fontsize = item.value/min+"em"; });
        this.elements = elements;
      } else {
        this.elements = this._randomElements();
      }
      this.addEventListener('resize', function(){
        console.log('resized');
      });
    },
    _randomElements: function() {
        var nEl = parseInt(Math.random() * 5) + 5;
        var elements = [];
        var val;
        var bg;
        var col;
        var r;
        var g;
        var b;
        var r1;
        var b1;
        var g1;
        for (var i = 0; i < nEl; i++) {
          val = parseInt(Math.random() * 100) + 50;
          r = parseInt(Math.random() * 255);
          g = parseInt(Math.random() * 255);
          b = parseInt(Math.random() * 255);
          bg = "rgba(" + r + "," + g + "," + b + "," + val / 150 + ")";
          elements.push({
            "name": "Circle " + i,
            "value": val,
            "bg": bg
          });
        }
        return elements;
      }
  });

  </script>
</dom-module>
